<!DOCTYPE html>
<html>
<head>
    <title>Upload File</title>
    <style>
        body { font-family: sans-serif; }
        .container { max-width: 500px; margin: 50px auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        h1 { text-align: center; margin-bottom: 30px; }
        input[type="file"] { margin-bottom: 15px; }
        button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        #result { margin-top: 30px; display: none; } /* Sembunyikan secara default */
        #fileUrl { width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box; }
        #copyButton { margin-top: 5px; }
        #message{margin-top: 1rem;}
        /* Tambahan untuk preview */
        #preview { margin-top: 20px; max-width: 100%;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Upload File</h1>
        <form id="uploadForm">
            <input type="file" name="berkas" accept="*/*">
            <button type="submit">Upload</button>
        </form>

        <div id="result">
            <h2>Hasil Upload:</h2>
            <input type="text" id="fileUrl" readonly>
            <button id="copyButton">Copy URL</button>
             <p id="message"></p>
              <!-- Elemen untuk preview -->
            <img id="preview" src="" alt="Preview">
        </div>
    </div>

    <script>
      const form = document.getElementById('uploadForm');
        const resultDiv = document.getElementById('result');
        const fileUrlInput = document.getElementById('fileUrl');
        const copyButton = document.getElementById('copyButton');
        const messageP = document.getElementById('message');
        const previewImg = document.getElementById('preview'); // Ambil elemen preview



        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(form);
              //Validasi Client side
            if (!form.berkas.files.length) {
                messageP.textContent = 'Pilih file terlebih dahulu.';
                 resultDiv.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/uploads', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json(); // Selalu parse sebagai JSON

                 if (response.ok) {
                    fileUrlInput.value = data.fileUrl; // Hanya URL yang ditampilkan
                    resultDiv.style.display = 'block'; // Tampilkan div hasil
                    copyButton.disabled = false;

                    // Tampilkan preview jika URL mengarah ke gambar
                    previewImg.src = data.fileUrl;
                    previewImg.onload = () => { // pastikan preview tampil setelah gambar di-load
                        resultDiv.style.display = 'block';
                    };
					previewImg.onerror = () => { //jika error
						previewImg.style.display = "none";
					}

                 }else{
                    messageP.textContent = data.message
                    resultDiv.style.display = 'block';
                    copyButton.disabled = true; //jangan bisa di copy
                 }


            } catch (error) {
                messageP.textContent = 'Terjadi kesalahan: ' + error;
                resultDiv.style.display = 'block';
                 copyButton.disabled = true; //jangan bisa di copy
            }
        });

        copyButton.addEventListener('click', () => {
             fileUrlInput.select();
              document.execCommand('copy');
              messageP.textContent = 'URL berhasil disalin!';

                setTimeout(() => { // hilang kan pesan dalam 2 detik
                    messageP.textContent = '';
                }, 2000);
        });
    </script>
</body>
</html>
